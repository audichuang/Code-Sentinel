<idea-plugin>
    <id>com.cathaybk.codingassistant</id>
    <name>Code Sentinel</name>
    <version>1.0.0</version>
    <vendor email="audiapplication880208@gmail.com" url="https://github.com/audichuang">AudiChuang</vendor>

    <description><![CDATA[Code Sentinel - Intelligent coding assistant and pre-commit guard for IntelliJ IDEA. Ensures code quality through real-time inspections, pre-commit checks, and smart quick fixes.

<h2>Code Sentinel: Your Intelligent Coding and Commit Guard</h2>
<p>Code Sentinel is a developer assistant plugin designed for IntelliJ IDEA, providing <b>real-time code analysis</b> and <b>pre-commit checks</b> to ensure code quality, maintain team coding standards, and significantly improve development workflow efficiency.</p>

<hr/>

<h3>Core Features</h3>

<b>Real-time Inspection and Quick Fixes (While Coding)</b>
<ul>
    <li><b>Code Standards Sentinel:</b> Instantly catches code that doesn't comply with predefined standards (e.g., API MsgID format, missing Javadoc) as you type.</li>
    <li><b>Smart Fixes:</b> Provides context-aware quick fix suggestions (via Alt+Enter / Option+Enter) for detected issues, generating or correcting code with one click.</li>
</ul>

<b>Pre-commit Guard (During Git Commit - Optional)</b>
<ul>
    <li><b>Git Branch Check:</b> Automatically runs git fetch and compares with target branch, preventing commits based on outdated branches and reducing merge conflict risks.</li>
    <li><b>Code Quality Gate:</b> Comprehensively scans pending code changes to ensure compliance with team-defined coding standards.</li>
    <li><b>Issue Dashboard:</b> Clearly lists all detected issues in a dedicated tool window ("Code Sentinel Inspection") for easy review.</li>
    <li><b>Batch Fix ("Fix All"):</b> Provides powerful one-click fix functionality to automatically resolve all fixable issues, saving valuable time.</li>
</ul>

<b>Smart Assistance</b>
<ul>
    <li><b>Javadoc Generator:</b> Automatically generates Javadoc comments for methods or classes. Supports generating complete structures with full tags (<code>@param</code>, <code>@return</code>) or minimal structures with core descriptions only, configurable in settings.</li>
    <li><b>API Search:</b> Search and browse all APIs in your project via Search Everywhere (Shift+Shift) or the dedicated API Search tool window.</li>
    <li><b>API Copy:</b> Copy complete API code including all dependencies to clipboard for easy sharing or documentation.</li>
</ul>

<hr/>

<h3>Highly Configurable</h3>
<p>Customize according to team or personal needs in <code>Settings &gt; Tools &gt; Code Sentinel</code>:</p>
<ul>
    <li>Enable/disable Git branch checking</li>
    <li>Enable/disable pre-commit code standard checks</li>
    <li>Choose Javadoc generation style (Full/Minimal)</li>
    <li>Configure target branch for comparison</li>
</ul>

<p>Let Code Sentinel be your reliable assistant and quality guardian throughout your coding journey!</p>
    ]]></description>

    <change-notes><![CDATA[
    <b>v1.0.0 - Initial Release</b>
    <p>Code Sentinel is your intelligent coding assistant and pre-commit guard for IntelliJ IDEA.</p>

    <h4>Core Features</h4>
    <ul>
        <li><b>Real-time Code Inspection</b>
            <ul>
                <li>API MsgID format validation for Controller/Service classes</li>
                <li>Javadoc presence check for @Autowired/@Resource fields</li>
                <li>Instant feedback with warning highlights in the editor</li>
            </ul>
        </li>
        <li><b>Pre-commit Guard</b>
            <ul>
                <li>Automatic Git branch status check before commit</li>
                <li>Code quality gate for pending changes</li>
                <li>Configurable target branch comparison</li>
            </ul>
        </li>
        <li><b>Smart Quick Fixes</b>
            <ul>
                <li>One-click API ID generation and insertion</li>
                <li>Auto-generate Javadoc for fields and methods</li>
                <li>Batch fix all issues at once</li>
            </ul>
        </li>
        <li><b>API Search & Discovery</b>
            <ul>
                <li>Search Everywhere integration (Shift+Shift → APIs tab)</li>
                <li>Dedicated API Search tool window</li>
                <li>Copy complete API code with dependencies</li>
            </ul>
        </li>
        <li><b>Highly Configurable</b>
            <ul>
                <li>Enable/disable Git branch checking</li>
                <li>Enable/disable code quality checks</li>
                <li>Choose Javadoc generation style (Full/Minimal)</li>
                <li>Configure target branches for comparison</li>
            </ul>
        </li>
    </ul>

    <h4>Technical Highlights</h4>
    <ul>
        <li>Optimized for large codebases with intelligent caching</li>
        <li>Memory-efficient with automatic cleanup</li>
        <li>Thread-safe PSI access with proper ReadAction wrapping</li>
        <li>Compatible with IntelliJ IDEA 2025.2 and later</li>
    </ul>
    ]]></change-notes>

    <!-- 更新 until-build 到一個較新的版本或保持通用 -->
    <idea-version since-build="252"/>

    <!-- 依賴關係 -->
    <depends>com.intellij.modules.platform</depends>
    <depends>com.intellij.modules.java</depends>

    <extensions defaultExtensionNs="com.intellij">
        <!-- Notification group for Code Sentinel -->
        <notificationGroup id="Code Sentinel" 
                          displayType="BALLOON"/>
        
        <!-- 1. 原有的 API MsgID 檢查器 -->
        <localInspection language="JAVA"
                         displayName="API MsgID檢查"
                         groupName="Code Sentinel"
                         enabledByDefault="true"
                         level="WARNING"
                         shortName="ApiMsgIdInspection"
                         implementationClass="com.cathaybk.codingassistant.inspection.ApiMsgIdInspection"/>

        <!-- ======================================== -->
        <!-- 2. 新增的 注入欄位 Javadoc 檢查器        -->
        <!--    (所有註解都已移到標籤外部)          -->
        <!-- ======================================== -->
        <localInspection language="JAVA"
                         displayName="注入的欄位缺少 Javadoc"
                         groupName="Code Sentinel"
                         enabledByDefault="true"
                         level="WARNING"
                         shortName="InjectedFieldJavadocInspection"
                         implementationClass="com.cathaybk.codingassistant.inspection.InjectedFieldJavadocInspection"/>

        <!-- ======================================== -->
        <!-- 5. 新增創建 DTO 模板的 Intention        -->
        <!-- ======================================== -->
        <intentionAction>
            <className>com.cathaybk.codingassistant.intention.CreateDtoIntentionAction</className>
            <category>Code Sentinel/模板生成</category> <!-- 分類會顯示在 Intention 設定中 -->
        </intentionAction>

        <!-- ======================================== -->
        <!-- 3. 新增 Commit 前檢查處理器           -->
        <!-- ======================================== -->
        <checkinHandlerFactory implementation="com.cathaybk.codingassistant.vcs.PreCommitInspectionHandlerFactory"/>

        <!-- ======================================== -->
        <!-- 4. 新增 Git 設置組件                   -->
        <!-- ======================================== -->
        <projectService serviceImplementation="com.cathaybk.codingassistant.settings.GitSettings"/>
        <applicationConfigurable 
                             groupId="tools" 
                             instance="com.cathaybk.codingassistant.settings.GitSettingsConfigurable"
                             id="com.cathaybk.codingassistant.settings.GitSettingsConfigurable" 
                             displayName="Code Sentinel"/>
        
        <!-- ======================================== -->
        <!-- 5. 新增緩存管理器服務                   -->
        <!-- ======================================== -->
        <projectService serviceImplementation="com.cathaybk.codingassistant.cache.InspectionCacheManager"/>

        <!-- ======================================== -->
        <!-- 6. API 複製功能服務                      -->
        <!-- ======================================== -->
        <projectService serviceImplementation="com.cathaybk.codingassistant.apicopy.service.ApiIndexService"/>
        <projectService serviceImplementation="com.cathaybk.codingassistant.apicopy.service.ApiCopyService"/>

        <!-- ======================================== -->
        <!-- 7. API 搜尋工具視窗                      -->
        <!-- ======================================== -->
        <toolWindow id="API 搜尋"
                    anchor="right"
                    factoryClass="com.cathaybk.codingassistant.apicopy.ui.ApiSearchToolWindowFactory"/>

        <!-- ======================================== -->
        <!-- 8. Code Sentinel 檢查結果工具視窗        -->
        <!-- ======================================== -->
        <toolWindow id="Code Sentinel 檢查"
                    anchor="bottom"
                    factoryClass="com.cathaybk.codingassistant.vcs.ProblemToolWindowFactory"
                    canCloseContents="true"/>

        <!-- ======================================== -->
        <!-- 8. Search Everywhere API 搜尋整合        -->
        <!-- ======================================== -->
        <searchEverywhereContributor
                implementation="com.cathaybk.codingassistant.apicopy.searcheverywhere.ApiSearchEverywhereContributorFactory"/>

    </extensions>

    <!-- ======================================== -->
    <!-- Actions                                  -->
    <!-- ======================================== -->
    <actions>
        <!-- API 複製 Action 群組 -->
        <group id="CodeSentinel.ApiCopyGroup" text="Code Sentinel" popup="true">
            <add-to-group group-id="EditorPopupMenu" anchor="last"/>

            <action id="CodeSentinel.CopyFullApiAction"
                    class="com.cathaybk.codingassistant.apicopy.action.CopyFullApiAction"
                    text="複製完整 API 程式碼"
                    description="複製此 API 的所有相關檔案到剪貼簿"/>
        </group>

        <!-- 工具選單中的 Action -->
        <action id="CodeSentinel.OpenApiSearchAction"
                class="com.cathaybk.codingassistant.apicopy.action.OpenApiSearchAction"
                text="開啟 API 搜尋"
                description="開啟 API 搜尋工具視窗">
            <add-to-group group-id="ToolsMenu" anchor="last"/>
            <keyboard-shortcut keymap="$default" first-keystroke="ctrl alt A"/>
        </action>
    </actions>
</idea-plugin>